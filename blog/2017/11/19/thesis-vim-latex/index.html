<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="itkq"><meta name=description content="そろそろ修論を書く季節になった。もちろん Vim と LaTeX で書くつもりだが、ページ数が多くなるとコンパイルに時間がかかって不都合なので、章ごとに分割コンパイルしたいと考えた。 分割した LaTeX ファイルを subfiles を使ってコンパイルする - Qiita が見つかったが、これまで通り Skim で 1 つのファイルをライブプレビューしたかったので、一時的な .tex ファイルを生成してコンパイルする latexmk のラッパーを書いた。
次のようにセッティングしておく。
$ tree -a . ├── .config │ └── latexmk.yml ├── header.tex ├── introduction.tex ├── main.tex └── related_work.tex 1 directory, 5 files $ cat .config/latexmk.yml output_file: output.tex header: header.tex include_files: - introduction.tex - related_work.tex $ cat main.tex \input{introduction} \input{related_work} header.tex には \begin{document} より上の設定を書く。実際のラッパースクリプトは以下。 .config/latexmk.yml がある場合は、いい感じに \begin{document} &mldr; \end{document} を生成してコンパイルする。"><meta name=google-site-verification content="AyWEWMfqdOijgoPW5yMy188xoQqY46L6pFXyd3Jizyc"><meta property="og:title" content="Vim + LaTeX でいい感じに修論を書く"><meta property="og:description" content="そろそろ修論を書く季節になった。もちろん Vim と LaTeX で書くつもりだが、ページ数が多くなるとコンパイルに時間がかかって不都合なので、章ごとに分割コンパイルしたいと考えた。 分割した LaTeX ファイルを subfiles を使ってコンパイルする - Qiita が見つかったが、これまで通り Skim で 1 つのファイルをライブプレビューしたかったので、一時的な .tex ファイルを生成してコンパイルする latexmk のラッパーを書いた。
次のようにセッティングしておく。
$ tree -a . ├── .config │ └── latexmk.yml ├── header.tex ├── introduction.tex ├── main.tex └── related_work.tex 1 directory, 5 files $ cat .config/latexmk.yml output_file: output.tex header: header.tex include_files: - introduction.tex - related_work.tex $ cat main.tex \input{introduction} \input{related_work} header.tex には \begin{document} より上の設定を書く。実際のラッパースクリプトは以下。 .config/latexmk.yml がある場合は、いい感じに \begin{document} &mldr; \end{document} を生成してコンパイルする。"><meta property="og:type" content="article"><meta property="og:url" content="https://itkq.jp/blog/2017/11/19/thesis-vim-latex/"><meta property="article:published_time" content="2017-11-19T02:51:49+09:00"><meta property="article:modified_time" content="2017-11-19T02:51:49+09:00"><title>Vim + LaTeX でいい感じに修論を書く</title><link rel=canonical href=https://itkq.jp/blog/2017/11/19/thesis-vim-latex/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/github.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500"><link rel=stylesheet href="https://itkq.jp/css/reset.css?t=2020-06-20%2016%3a32%3a17.762934255%20%2b0900%20JST%20m%3d%2b0.127383107"><link rel=stylesheet href="https://itkq.jp/css/pygments.css?t=2020-06-20%2016%3a32%3a17.762934255%20%2b0900%20JST%20m%3d%2b0.127383107"><link rel=stylesheet href="https://itkq.jp/css/main.css?t=2020-06-20%2016%3a32%3a17.762934255%20%2b0900%20JST%20m%3d%2b0.127383107"><link rel=stylesheet href="https://itkq.jp/css/override.css?t=2020-06-20%2016%3a32%3a17.762934255%20%2b0900%20JST%20m%3d%2b0.127383107"><link rel="shortcut icon" href=https://itkq.jp/img/leaf.ico></head><body lang=ja><section class=header><div class=container><a href=https://itkq.jp/><img class=avatar src=https://itkq.jp/img/profile.png srcset="https://itkq.jp/img/profile.png 1x"></a><div class=content><a href=https://itkq.jp/><div class=name>itkq</div></a><nav><ul><li class=nav-blog><a href=https://itkq.jp/blog/><span>Blog</span></a></li><li class=nav-about><a href=https://itkq.jp/about/><span>About</span></a></li></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=https://github.com/itkq target=_blank rel=noopener><img class=icon src=https://itkq.jp/img/github.svg alt=github></a>
<a href=https://twitter.com/itkq target=_blank rel=noopener><img class=icon src=https://itkq.jp/img/twitter.svg alt=twitter></a>
<a href=//linkedin.com/in/takuya-kosugiyama-107402195/ target=_blank rel=noopener><img class=icon src=https://itkq.jp/img/linkedin.svg alt=linkedin></a>
<a href=mailto:re@itkq.jp><img class=icon src=https://itkq.jp/img/email.svg alt=email></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Vim + LaTeX でいい感じに修論を書く</div><div class=initials><a href=https://itkq.jp/>ad</a></div></div><div class=meta><div class=date title="Sun Nov 19 2017 02:51:49 JST">Nov 19, 2017</div></div></div><div class=markdown><p>そろそろ修論を書く季節になった。もちろん Vim と LaTeX で書くつもりだが、ページ数が多くなるとコンパイルに時間がかかって不都合なので、章ごとに分割コンパイルしたいと考えた。
<a href=https://qiita.com/sankichi92/items/1e113fcf6cc045eb64f7>分割した LaTeX ファイルを subfiles を使ってコンパイルする - Qiita</a> が見つかったが、これまで通り Skim で 1 つのファイルをライブプレビューしたかったので、一時的な .tex ファイルを生成してコンパイルする latexmk のラッパーを書いた。</p><p>次のようにセッティングしておく。</p><pre><code>$ tree -a
.
├── .config
│   └── latexmk.yml
├── header.tex
├── introduction.tex
├── main.tex
└── related_work.tex

1 directory, 5 files

$ cat .config/latexmk.yml
output_file: output.tex
header: header.tex
include_files:
  - introduction.tex
  - related_work.tex

$ cat main.tex
\input{introduction}
\input{related_work}
</code></pre><p>header.tex には <code>\begin{document}</code> より上の設定を書く。実際のラッパースクリプトは以下。
.config/latexmk.yml がある場合は、いい感じに <code>\begin{document}</code> &mldr; <code>\end{document}</code> を生成してコンパイルする。</p><div class=highlight><pre class=chroma><code class=language-rb data-lang=rb><span class=ch>#!/usr/bin/env ruby</span>

<span class=nb>require</span> <span class=s1>&#39;yaml&#39;</span>

<span class=no>CONFIG_PATH</span> <span class=o>=</span> <span class=s1>&#39;./.config/latexmk.yml&#39;</span>
<span class=no>LATEXMK_PATH</span> <span class=o>=</span> <span class=s1>&#39;/Users/itkq/my_bin/latexmk&#39;</span>

<span class=k>def</span> <span class=nf>remove_tex_ext</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
  <span class=no>File</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s2>&#34;.tex&#34;</span><span class=p>)</span>
<span class=k>end</span>

<span class=k>unless</span> <span class=no>File</span><span class=o>.</span><span class=n>exist?</span><span class=p>(</span><span class=no>CONFIG_PATH</span><span class=p>)</span>
  <span class=sb>`</span><span class=si>#{</span><span class=no>LATEXMK_PATH</span><span class=si>}</span><span class=sb> </span><span class=si>#{</span><span class=no>ARGV</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span>
  <span class=nb>exit</span> <span class=vg>$?</span>
<span class=k>end</span>

<span class=n>yaml</span> <span class=o>=</span> <span class=no>YAML</span><span class=o>.</span><span class=n>load_file</span><span class=p>(</span><span class=no>CONFIG_PATH</span><span class=p>)</span>
<span class=n>output_file</span> <span class=o>=</span> <span class=n>yaml</span><span class=o>[</span><span class=s2>&#34;output_file&#34;</span><span class=o>]</span> <span class=o>||</span> <span class=s2>&#34;./output.tex&#34;</span>
<span class=n>header</span> <span class=o>=</span> <span class=n>yaml</span><span class=o>[</span><span class=s2>&#34;header&#34;</span><span class=o>]</span> <span class=o>||</span> <span class=s2>&#34;./header.tex&#34;</span>
<span class=n>include_files</span> <span class=o>=</span> <span class=n>yaml</span><span class=o>[</span><span class=s2>&#34;include_files&#34;</span><span class=o>]</span>

<span class=n>input_file</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=no>ARGV</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>)</span>
<span class=nb>exit</span> <span class=mi>0</span> <span class=k>if</span> <span class=n>input_file</span> <span class=o>==</span> <span class=n>header</span>

<span class=n>includes</span> <span class=o>=</span> <span class=k>if</span> <span class=n>include_files</span><span class=o>.</span><span class=n>include?</span><span class=p>(</span><span class=n>input_file</span><span class=p>)</span>
             <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>input{</span><span class=si>#{</span><span class=n>remove_tex_ext</span><span class=p>(</span><span class=n>input_file</span><span class=p>)</span><span class=si>}</span><span class=s2>}&#34;</span>
           <span class=k>else</span>
             <span class=n>include_files</span><span class=o>.</span><span class=n>map</span><span class=p>{</span><span class=o>|</span><span class=n>f</span><span class=o>|</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>input{</span><span class=si>#{</span><span class=n>remove_tex_ext</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=si>}</span><span class=s2>}&#34;</span><span class=p>}</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
           <span class=k>end</span>

<span class=n>body</span> <span class=o>=</span> <span class=s>&lt;&lt;EOF
</span><span class=s></span><span class=p>\\</span><span class=k>begin</span><span class=p>{</span><span class=n>document</span><span class=p>}</span>
<span class=c1>#{includes}</span>
<span class=p>\\</span><span class=k>end</span><span class=p>{</span><span class=n>document</span><span class=p>}</span>
<span class=no>EOF</span>

<span class=n>output</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>header</span><span class=p>)</span> <span class=o>+</span> <span class=n>body</span>
<span class=no>File</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>output_file</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>

<span class=sb>`</span><span class=si>#{</span><span class=no>LATEXMK_PATH</span><span class=si>}</span><span class=sb> </span><span class=si>#{</span><span class=n>output_file</span><span class=si>}</span><span class=sb> &amp;&amp; </span><span class=si>#{</span><span class=no>LATEXMK_PATH</span><span class=si>}</span><span class=sb> -c`</span>

</code></pre></div><p>Vim の Quickrun の設定を次のように書く。</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=k>let</span> <span class=nx>g</span>:<span class=nx>quickrun_config</span>[<span class=s1>&#39;tex&#39;</span>] <span class=p>=</span> {<span class=err>
</span><span class=err></span>\   <span class=s1>&#39;exec&#39;</span>: <span class=s1>&#39;%c %s&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>\   <span class=s1>&#39;command&#39;</span> : <span class=s1>&#39;latexmk_wrapper&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>\}<span class=err>
</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>BufWritePost</span> *.<span class=nx>tex</span> :<span class=nx>QuickRun</span> <span class=nx>tex</span><span class=err>
</span></code></pre></div><p>Vim で分割された .tex ファイルを開いている場合に <code>:w</code> すると、そのファイルの情報だけが PDF 化される。
ファイル間をまたいだ参照は解決されないが、最後に全体を確認すればいいので大した問題にはならないと思う。
これで修論はできたも同然であろう。</p><br><p class=back-to-posts><a href=https://itkq.jp/blog/>Back to posts</a></p></div><br><div class=disqus><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"itkq-jp"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-71205730-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>