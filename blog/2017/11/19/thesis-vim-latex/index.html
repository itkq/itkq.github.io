<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content=True><meta name=MobileOptimized content=320><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content=no-referrer><meta name=author content=itkq><meta name=description content="そろそろ修論を書く季節になった。もちろん Vim と LaTeX で書くつもりだが、ページ数が多くなるとコンパイルに時間がかかって不都合なので、章ごとに分割コンパイルしたいと考えた。 分割した LaTeX ファイルを subfiles を使ってコンパイルする - Qiita が見つかったが、これまで通り Skim で 1 つのファイルをライブプレビューしたかったので、一時的な .tex ファイルを生成してコンパイルする latexmk のラッパーを書いた。
次のようにセッティングしておく。
$ tree -a . ├── .config │ └── latexmk.yml ├── header.tex ├── introduction.tex ├── main.tex └── related_work.tex 1 directory, 5 files $ cat .config/latexmk.yml output_file: output.tex header: header.tex include_files: - introduction.tex - related_work.tex $ cat main.tex \input{introduction} \input{related_work}  header.tex には \begin{document} より上の設定を書く。実際のラッパースクリプトは以下。 .config/latexmk.yml がある場合は、いい感じに \begin{document} &hellip; \end{document} を生成してコンパイルする。"><meta name=google-site-verification content=AyWEWMfqdOijgoPW5yMy188xoQqY46L6pFXyd3Jizyc><meta property=og:title content="Vim &#43; LaTeX でいい感じに修論を書く"><meta property=og:description content="そろそろ修論を書く季節になった。もちろん Vim と LaTeX で書くつもりだが、ページ数が多くなるとコンパイルに時間がかかって不都合なので、章ごとに分割コンパイルしたいと考えた。 分割した LaTeX ファイルを subfiles を使ってコンパイルする - Qiita が見つかったが、これまで通り Skim で 1 つのファイルをライブプレビューしたかったので、一時的な .tex ファイルを生成してコンパイルする latexmk のラッパーを書いた。
次のようにセッティングしておく。
$ tree -a . ├── .config │ └── latexmk.yml ├── header.tex ├── introduction.tex ├── main.tex └── related_work.tex 1 directory, 5 files $ cat .config/latexmk.yml output_file: output.tex header: header.tex include_files: - introduction.tex - related_work.tex $ cat main.tex \input{introduction} \input{related_work}  header.tex には \begin{document} より上の設定を書く。実際のラッパースクリプトは以下。 .config/latexmk.yml がある場合は、いい感じに \begin{document} &hellip; \end{document} を生成してコンパイルする。"><meta property=og:type content=article><meta property=og:url content=https://itkq.jp/blog/2017/11/19/thesis-vim-latex/><meta property=article:published_time content=2017-11-19T02:51:49&#43;09:00><meta property=article:modified_time content=2017-11-19T02:51:49&#43;09:00><title>Vim &#43; LaTeX でいい感じに修論を書く</title><link rel=canonical href=https://itkq.jp/blog/2017/11/19/thesis-vim-latex/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/github.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500"><link rel=stylesheet href="https://itkq.jp/css/reset.css?t=2020-06-20%2014%3a17%3a11.049419374%20%2b0900%20JST%20m%3d%2b0.082773760"><link rel=stylesheet href="https://itkq.jp/css/pygments.css?t=2020-06-20%2014%3a17%3a11.049419374%20%2b0900%20JST%20m%3d%2b0.082773760"><link rel=stylesheet href="https://itkq.jp/css/main.css?t=2020-06-20%2014%3a17%3a11.049419374%20%2b0900%20JST%20m%3d%2b0.082773760"><link rel=stylesheet href="https://itkq.jp/css/override.css?t=2020-06-20%2014%3a17%3a11.049419374%20%2b0900%20JST%20m%3d%2b0.082773760"><link rel="shortcut icon" href=https://itkq.jp/img/leaf.ico></head><body lang=ja><section class=header><div class=container><a href=https://itkq.jp/><img class=avatar src=https://itkq.jp/img/profile.png srcset="https://itkq.jp/img/profile.png 1x"></a><div class=content><a href=https://itkq.jp/><div class=name>itkq</div></a><nav><ul><li class=nav-blog><a href=https://itkq.jp/blog/><span>Blog</span></a></li><li class=nav-about><a href=https://itkq.jp/about/><span>About</span></a></li></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=https://github.com/itkq target=_blank rel=noopener><img class=icon src=https://itkq.jp/img/github.svg alt=github></a>
<a href=https://twitter.com/itkq target=_blank rel=noopener><img class=icon src=https://itkq.jp/img/twitter.svg alt=twitter></a>
<a href=//linkedin.com/in/takuya-kosugiyama-107402195/ target=_blank rel=noopener><img class=icon src=https://itkq.jp/img/linkedin.svg alt=linkedin></a>
<a href=mailto:re@itkq.jp><img class=icon src=https://itkq.jp/img/email.svg alt=email></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Vim &#43; LaTeX でいい感じに修論を書く</div><div class=initials><a href=https://itkq.jp/>ad</a></div></div><div class=meta><div class=date title="Sun Nov 19 2017 02:51:49 JST">Nov 19, 2017</div></div></div><div class=markdown><p>そろそろ修論を書く季節になった。もちろん Vim と LaTeX で書くつもりだが、ページ数が多くなるとコンパイルに時間がかかって不都合なので、章ごとに分割コンパイルしたいと考えた。
<a href=https://qiita.com/sankichi92/items/1e113fcf6cc045eb64f7>分割した LaTeX ファイルを subfiles を使ってコンパイルする - Qiita</a> が見つかったが、これまで通り Skim で 1 つのファイルをライブプレビューしたかったので、一時的な .tex ファイルを生成してコンパイルする latexmk のラッパーを書いた。</p><p>次のようにセッティングしておく。</p><pre><code>$ tree -a
.
├── .config
│   └── latexmk.yml
├── header.tex
├── introduction.tex
├── main.tex
└── related_work.tex

1 directory, 5 files

$ cat .config/latexmk.yml
output_file: output.tex
header: header.tex
include_files:
  - introduction.tex
  - related_work.tex

$ cat main.tex
\input{introduction}
\input{related_work}
</code></pre><p>header.tex には <code>\begin{document}</code> より上の設定を書く。実際のラッパースクリプトは以下。
.config/latexmk.yml がある場合は、いい感じに <code>\begin{document}</code> &hellip; <code>\end{document}</code> を生成してコンパイルする。</p><pre><code class=language-rb>#!/usr/bin/env ruby

require 'yaml'

CONFIG_PATH = './.config/latexmk.yml'
LATEXMK_PATH = '/Users/itkq/my_bin/latexmk'

def remove_tex_ext(filename)
  File.basename(filename, &quot;.tex&quot;)
end

unless File.exist?(CONFIG_PATH)
  `#{LATEXMK_PATH} #{ARGV.join(&quot; &quot;)}`
  exit $?
end

yaml = YAML.load_file(CONFIG_PATH)
output_file = yaml[&quot;output_file&quot;] || &quot;./output.tex&quot;
header = yaml[&quot;header&quot;] || &quot;./header.tex&quot;
include_files = yaml[&quot;include_files&quot;]

input_file = File.basename(ARGV[0])
exit 0 if input_file == header

includes = if include_files.include?(input_file)
             &quot;\\input{#{remove_tex_ext(input_file)}}&quot;
           else
             include_files.map{|f| &quot;\\input{#{remove_tex_ext(f)}}&quot;}.join(&quot;\n&quot;)
           end

body = &lt;&lt;EOF
\\begin{document}
#{includes}
\\end{document}
EOF

output = File.read(header) + body
File.write(output_file, output)

`#{LATEXMK_PATH} #{output_file} &amp;&amp; #{LATEXMK_PATH} -c`

</code></pre><p>Vim の Quickrun の設定を次のように書く。</p><pre><code class=language-vim>let g:quickrun_config['tex'] = {
\   'exec': '%c %s',
\   'command' : 'latexmk_wrapper',
\}

autocmd BufWritePost *.tex :QuickRun tex
</code></pre><p>Vim で分割された .tex ファイルを開いている場合に <code>:w</code> すると、そのファイルの情報だけが PDF 化される。
ファイル間をまたいだ参照は解決されないが、最後に全体を確認すればいいので大した問題にはならないと思う。
これで修論はできたも同然であろう。</p><p><iframe src=https://player.vimeo.com/video/243456055 width=640 height=360 frameborder=0 webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe><p><a href=https://vimeo.com/243456055>vim-latex</a> from <a href=https://vimeo.com/user74437848>itkq</a> on <a href=https://vimeo.com>Vimeo</a>.</p></p><br><p class=back-to-posts><a href=https://itkq.jp/blog/>Back to posts</a></p></div><br><div class=disqus><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"itkq-jp"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-71205730-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>